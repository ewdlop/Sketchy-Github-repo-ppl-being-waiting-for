# ğŸƒ

ChatGPT: é€™è£¡æ˜¯å¹¾å€‹ã€Œè¬è–ç¯€ä¸»é¡Œã€çš„ **Sketchy SQL Queries**ï¼ˆè©­ç•°ã€ææ€ªåˆå¸¶é»é§­å®¢é¢¨æ ¼ï¼‰ğŸƒï¼Œç´”å±¬å¹½é»˜èˆ‡æ•™å­¸ç”¨é€”ï¼Œè«‹å‹¿åœ¨çœŸå¯¦ç”Ÿç”¢è³‡æ–™åº«ä¸ŠåŸ·è¡Œã€‚
æ‰€æœ‰ä¾‹å­å‡å®‰å…¨å¯æ¸¬è©¦ï¼ˆåªæŸ¥è©¢ä¸æ”¹è³‡æ–™ï¼‰ï¼Œä¸¦é™„ä¸Šè§£é‡‹ã€‚

---

## ğŸ§›â€â™‚ï¸ 1. æ‰¾å‡ºã€Œå¹½éˆç´€éŒ„ã€

```sql
SELECT *
FROM users
WHERE last_login IS NULL
  OR deleted_at IS NOT NULL;
```

**èªªæ˜**ï¼š
é€™äº›å¸³è™Ÿå¾æ²’ç™»å…¥éæˆ–æ—©å°±ã€Œè¢«åˆªé™¤ã€å»é‚„åœ¨è³‡æ–™åº«è£¡â”€â”€æœ€åƒã€Œå¹½éˆã€çš„å­˜åœ¨ã€‚

---

## ğŸ§™â€â™€ï¸ 2. è©›å’’è§¸ç™¼ç´€éŒ„

```sql
SELECT id, username, COUNT(*) AS curse_count
FROM logs
WHERE message LIKE '%forbidden%' OR message LIKE '%unauthorized%'
GROUP BY id, username
HAVING curse_count > 3;
```

**èªªæ˜**ï¼š
æ‰¾å‡ºå¤šæ¬¡è§¸ç™¼ã€Œç¦å¿Œã€æ“ä½œçš„ä½¿ç”¨è€…ã€‚
3 æ¬¡ä»¥ä¸Š = å·²ç¶“ä¸­äº† SQL è©›å’’ã€‚

---

## ğŸª¦ 3. å¾å¢³å¢“çˆ¬å‡ºçš„è³‡æ–™

```sql
SELECT *
FROM products
WHERE discontinued = 1
  AND DATEDIFF(DAY, deleted_at, GETDATE()) > 365;
```

**èªªæ˜**ï¼š
åˆ—å‡ºã€Œæ­»è€Œå¾©ç”Ÿã€è¶…éä¸€å¹´çš„å•†å“ã€‚
é©åˆç”¨ä¾†æ¸…ç†è³‡æ–™åº«çš„ã€Œæ®­å±è³‡æ–™ã€ã€‚

---

## ğŸ§Ÿâ€â™‚ï¸ 4. é€£çµå…©å€‹ä¸–ç•Œ

```sql
SELECT u.username, o.order_id
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE o.user_id IS NULL;
```

**èªªæ˜**ï¼š
é€™æŸ¥è©¢æœƒæ‰¾åˆ°ã€Œæ²’æœ‰ä»»ä½•è¨‚å–®ã€çš„ä½¿ç”¨è€…ã€‚
ä»–å€‘å°±åƒåœ¨äººé–“è¡Œèµ°çš„ã€Œç„¡ä¸»é­‚ã€ã€‚

---

## ğŸ•¸ï¸ 5. èœ˜è››ç¶²æŸ¥è©¢ï¼ˆå¾ªç’°å¼•ç”¨ï¼‰

```sql
WITH RECURSIVE spider_web AS (
  SELECT id, parent_id, name
  FROM categories
  WHERE parent_id IS NULL
  UNION ALL
  SELECT c.id, c.parent_id, c.name
  FROM categories c
  JOIN spider_web s ON c.parent_id = s.id
)
SELECT * FROM spider_web;
```

**èªªæ˜**ï¼š
ç”¨éè¿´ CTE çˆ¬æ•´æ£µåˆ†é¡æ¨¹ã€‚
ä½†è‹¥è³‡æ–™å‡ºç¾å¾ªç’°ï¼ˆself-loopï¼‰ï¼Œé€™æŸ¥è©¢æœƒé™·å…¥ç„¡ç›¡çš„ã€Œèœ˜è››ç¶²ã€ã€‚

---

## ğŸ©¸ 6. éš±è—çš„è¡€è·¡ï¼ˆRed Flagsï¼‰

```sql
SELECT *
FROM transactions
WHERE amount < 0
  OR description LIKE '%error%'
  OR status IN ('failed', 'reversed');
```

**èªªæ˜**ï¼š
æŠ“å‡ºã€Œç•°å¸¸äº¤æ˜“ã€â”€â”€åƒè¡€è·¡ä¸€æ¨£çš„è­¦è¨Šã€‚
ç´…æ——ä¸åªæ˜¯ç¯€æ…¶é¡è‰²ã€‚

---

## ğŸƒ Bonusï¼šéš¨æ©Ÿå¬å–šä¸€ç­†è¨˜éŒ„

```sql
SELECT TOP 1 *
FROM victims -- å‘ƒâ€¦å‡è¨­é€™æ˜¯å€‹ Halloween Table åç¨±
ORDER BY NEWID();
```

**èªªæ˜**ï¼š
æ¯æ¬¡åŸ·è¡Œéƒ½éš¨æ©Ÿå¬å–šä¸€ç­†è³‡æ–™ã€‚
ä½ æ°¸é ä¸çŸ¥é“æœƒå«å‡ºèª°ã€‚

---

ğŸ“š **SQL èªæ³•åƒè€ƒè³‡æ–™**ï¼š

* Microsoft Docs â€“ [Transact-SQL Reference](https://learn.microsoft.com/en-us/sql/t-sql/language-reference)
* PostgreSQL Documentation â€“ [SQL Syntax and CTEs](https://www.postgresql.org/docs/current/queries-with.html)

---

## ğŸ’€ 7. SQL Injection ç¯„ä¾‹ï¼ˆæ•™è‚²ç”¨é€”ï¼‰

### âŒ ä¸å®‰å…¨çš„æŸ¥è©¢ï¼ˆè„†å¼±é»ï¼‰

```python
# å±éšªï¼šç›´æ¥å°‡ä½¿ç”¨è€…è¼¸å…¥ä¸²æ¥åˆ° SQL æŸ¥è©¢ä¸­
username = input("Enter username: ")
password = input("Enter password: ")

# é€™æ¨£å¯«æœƒæœ‰ SQL Injection é¢¨éšªï¼
query = f"SELECT * FROM users WHERE username = '{username}' AND password = '{password}'"
cursor.execute(query)
```

**æ”»æ“Šç¯„ä¾‹**ï¼š
```
Username: admin' --
Password: éš¨ä¾¿è¼¸å…¥
```

**çµæœæŸ¥è©¢**ï¼š
```sql
SELECT * FROM users WHERE username = 'admin' --' AND password = 'éš¨ä¾¿è¼¸å…¥'
```

`--` æœƒè¨»è§£æ‰å¾Œé¢çš„å¯†ç¢¼æª¢æŸ¥ï¼Œæ”»æ“Šè€…å¯ä»¥ç¹éèªè­‰ï¼

---

### âœ… å®‰å…¨çš„æŸ¥è©¢ï¼ˆé˜²ç¦¦æ–¹æ³•ï¼‰

```python
# å®‰å…¨ï¼šä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢ï¼ˆParameterized Queryï¼‰
username = input("Enter username: ")
password = input("Enter password: ")

# ä½¿ç”¨å ä½ç¬¦ %sï¼Œè³‡æ–™åº«é©…å‹•æœƒè‡ªå‹•è™•ç†è·³è„«
query = "SELECT * FROM users WHERE username = %s AND password = %s"
cursor.execute(query, (username, password))
```

**ç‚ºä»€éº¼å®‰å…¨ï¼Ÿ**
- è³‡æ–™åº«æœƒå°‡ä½¿ç”¨è€…è¼¸å…¥ç•¶ä½œã€Œè³‡æ–™ã€è€Œéã€ŒSQL ç¨‹å¼ç¢¼ã€
- è‡ªå‹•è™•ç†ç‰¹æ®Šå­—å…ƒçš„è·³è„«ï¼ˆescapeï¼‰
- ç„¡æ³•æ”¹è®ŠæŸ¥è©¢çš„çµæ§‹

---

### ğŸ•·ï¸ æ›´å¤šæ”»æ“Šç¯„ä¾‹

#### 1. ç¹éç™»å…¥
```
Username: ' OR '1'='1' --
Password: ä»»æ„
```

#### 2. å–å¾—æ‰€æœ‰è³‡æ–™
```
productId=1 UNION SELECT username, password FROM users --
```

#### 3. åˆªé™¤è³‡æ–™è¡¨ï¼ˆå¦‚æœå…è¨±å¤šèªå¥åŸ·è¡Œï¼‰
```
userId=1; DROP TABLE users; --
```

---

### ğŸ›¡ï¸ é˜²ç¦¦æœ€ä½³å¯¦è¸

1. **æ°¸é ä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢æˆ– Prepared Statements**
   - Python: `cursor.execute(query, (param1, param2))`
   - Node.js: `connection.query(query, [param1, param2])`
   - PHP PDO: `$stmt->execute(['param' => $value])`
   - Java JDBC: `pstmt.setString(1, value)`

2. **ä½¿ç”¨ ORMï¼ˆObject-Relational Mappingï¼‰**
   - SQLAlchemy (Python)
   - Sequelize (Node.js)
   - Eloquent (PHP/Laravel)
   - Hibernate (Java)

3. **è¼¸å…¥é©—è­‰ï¼ˆç¬¬äºŒé“é˜²ç·šï¼‰**
   - æª¢æŸ¥è³‡æ–™å‹åˆ¥ï¼ˆä¾‹å¦‚ï¼šID å¿…é ˆæ˜¯æ•¸å­—ï¼‰
   - é™åˆ¶è¼¸å…¥é•·åº¦
   - ç™½åå–®éæ¿¾
   - **æ³¨æ„**ï¼šé©—è­‰ä¸èƒ½å–ä»£åƒæ•¸åŒ–æŸ¥è©¢ï¼

4. **æœ€å°æ¬Šé™åŸå‰‡**
   - æ‡‰ç”¨ç¨‹å¼ä¸æ‡‰ä½¿ç”¨ root/admin å¸³è™Ÿé€£æ¥è³‡æ–™åº«
   - åªçµ¦äºˆå¿…è¦çš„æ¬Šé™ï¼ˆSELECTã€INSERT ç­‰ï¼‰

5. **éŒ¯èª¤è™•ç†**
   - ä¸è¦å°‡è©³ç´°çš„è³‡æ–™åº«éŒ¯èª¤è¨Šæ¯é¡¯ç¤ºçµ¦ä½¿ç”¨è€…
   - è¨˜éŒ„éŒ¯èª¤ç”¨æ–¼é™¤éŒ¯ï¼Œä½†åªå›å‚³é€šç”¨è¨Šæ¯

---

## ğŸ“– å»¶ä¼¸é–±è®€

### å®‰å…¨è³‡æºï¼š
* OWASP â€“ [SQL Injection Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html)
* [OWASP Top 10 - Injection](https://owasp.org/www-project-top-ten/)
* [CWE-89: SQL Injection](https://cwe.mitre.org/data/definitions/89.html)

### æ¸¬è©¦å·¥å…·ï¼š
* **SQLMap** - è‡ªå‹•åŒ– SQL Injection æª¢æ¸¬å·¥å…·
* **OWASP ZAP** - Web æ‡‰ç”¨ç¨‹å¼å®‰å…¨æƒæå™¨
* **Burp Suite** - å°ˆæ¥­å®‰å…¨æ¸¬è©¦å·¥å…·

---

**è¨˜ä½**ï¼šå°æŠ— SQL Injection çš„å”¯ä¸€å¯é æ–¹æ³•æ˜¯ä½¿ç”¨**åƒæ•¸åŒ–æŸ¥è©¢**æˆ– **Prepared Statements**ã€‚å–®ç´”çš„è¼¸å…¥é©—è­‰æ˜¯ä¸å¤ çš„ï¼

ğŸƒ Happy (Secure) Halloween Coding! ğŸƒ
